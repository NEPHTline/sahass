<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>与SAHA的记账空间</title>
<style>
:root {
  --main:#A69383;
  --bg:#FFFEFC;
  --card:#F2E4D8;
  --text:#A69383;
}
body {
  font-family: "Arial Rounded MT Bold", sans-serif;
  margin:0; padding:20px; background:var(--bg); color:var(--text);
  display:flex; flex-direction:column; align-items:center;
}
h1{text-align:center; font-size:28px; color:var(--main); margin-bottom:5px;}
p.subtitle{text-align:center; font-size:12px; color:var(--text); margin-bottom:20px;}
input, button {
  border:none; border-radius:16px; padding:10px; font-size:16px; outline:none;
}
input{
  width:250px; margin:5px 0; background:var(--card);
  border-radius:20px; padding:12px; font-size:16px;
  transition: background 0.2s;
}
input:focus{background:#FFFFFF;}
.amount-box{background:var(--card); padding:20px; border-radius:24px; margin-bottom:15px; text-align:center;}
input#amountInput{border-radius:24px; padding:16px; font-size:20px; width:250px;}
input#dateInput, input#noteInput{border-radius:20px; padding:10px; font-size:14px; width:250px; background:var(--card);}
button#submitIncome, button#submitExpense{background:var(--main); color:#fff; font-size:18px; padding:14px 20px; margin:10px 5px; border-radius:20px; display:inline-block; width:120px;}
button.small-btn{background:var(--card); color:var(--text); font-size:12px; padding:6px 10px; margin:3px; border-radius:16px;}
button.active{background:var(--main); color:#fff;}
.tag-group{display:flex; flex-wrap:wrap; justify-content:center; gap:8px; margin:10px 0;}
.hidden{display:none;}
table{width:100%; border-collapse:collapse; margin-top:20px; border-radius:16px; overflow:hidden;}
td, th{padding:10px; border-bottom:1px solid var(--main); text-align:center;}
.delete-checkbox{width:20px;height:20px;}
.back-btn{position:absolute; top:20px; left:20px; background:var(--main); color:#fff; padding:8px 12px; border-radius:12px; cursor:pointer; font-size:12px;}
</style>
</head>
<body>
<h1>与SAHA的记账空间</h1>
<p class="subtitle">继续做下去、我会在你身后盯着、你正在成为能与我并列的那种存在</p>
<div id="input-page">
  <div class="amount-box">
    <input id="amountInput" type="number" step="0.01" placeholder="金额" />
  </div>
  <input id="dateInput" type="date" />
  <input id="noteInput" type="text" placeholder="备注（可选）" />
  <h3 style="text-align:center;">选择类别</h3>
  <div class="tag-group">
    <button class="category-btn" data-cat="必要">必要</button>
    <button class="category-btn" data-cat="提升">提升</button>
    <button class="category-btn" data-cat="快乐">快乐</button>
  </div>
  <div id="subtags-必要" class="tag-group hidden">
    <button class="subcat-btn" data-sub="还款">还款</button>
    <button class="subcat-btn" data-sub="吃饭">吃饭</button>
    <button class="subcat-btn" data-sub="送礼">送礼</button>
    <button class="subcat-btn" data-sub="日用品">日用品</button>
  </div>
  <div id="subtags-提升" class="tag-group hidden"></div>
  <div id="subtags-快乐" class="tag-group hidden">
    <button class="subcat-btn" data-sub="零食">零食</button>
    <button class="subcat-btn" data-sub="衣物">衣物</button>
    <button class="subcat-btn" data-sub="玩乐">玩乐</button>
    <button class="subcat-btn" data-sub="享受">享受</button>
  </div>
  <div style="text-align:center;">
    <button id="submitIncome">确定收入</button>
    <button id="submitExpense">确定支出</button>
  </div>
  <div style="text-align:center;">
    <button class="small-btn" onclick="showTable('all','income')">查看收入账单</button>
    <button class="small-btn" onclick="showTable('all','expense')">查看支出账单</button>
    <button class="small-btn" onclick="showWeekly()">周报</button>
    <button class="small-btn" onclick="showMonthly()">月报</button>
  </div>
</div>
<div id="table-page" class="hidden">
  <button class="back-btn" onclick="backToInput()">返回</button>
  <div style="text-align:center;">
    <button class="small-btn" id="summaryBtn">总览</button>
    <button class="small-btn" onclick="showTable('必要')">必要</button>
    <button class="small-btn" onclick="showTable('提升')">提升</button>
    <button class="small-btn" onclick="showTable('快乐')">快乐</button>
    <button class="small-btn" onclick="deleteSelected()">删除选中</button>
    <button class="small-btn" id="copyBtn">复制导出</button>
  </div>
  <div id="summary" style="margin-top:10px; text-align:center; font-size:12px;"></div>
  <table>
    <thead>
      <tr><th></th><th>日期</th><th>金额</th><th>类别</th><th>备注</th></tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>
<script>
let records=JSON.parse(localStorage.getItem('records')||'[]');
let selectedCategory='',selectedSub='';
let currentType='income';

function updateActive(buttons, clickedBtn){
  buttons.forEach(b=>b.classList.remove('active'));
  clickedBtn.classList.add('active');
}

document.querySelectorAll('.category-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    selectedCategory=btn.dataset.cat; selectedSub='';
    updateActive(document.querySelectorAll('.category-btn'), btn);
    document.querySelectorAll('[id^="subtags"]').forEach(d=>d.classList.add('hidden'));
    document.getElementById('subtags-'+selectedCategory).classList.remove('hidden');
  });
});

document.querySelectorAll('.subcat-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    selectedSub=btn.dataset.sub;
    updateActive(document.querySelectorAll('.subcat-btn'), btn);
  });
});

function addRecord(type){
  const amount=parseFloat(document.getElementById('amountInput').value);
  if(!amount){alert('请输入金额！'); return;}
  if(!selectedCategory){alert('请选择类别！'); return;}
  const remark=document.getElementById('noteInput').value||selectedSub||'';
  records.push({date:document.getElementById('dateInput').value,amount,category:selectedCategory,sub:selectedSub,note:remark,type:type});
  localStorage.setItem('records',JSON.stringify(records));
  document.getElementById('amountInput').value='';
  document.getElementById('dateInput').value='';
  document.getElementById('noteInput').value='';
  selectedCategory=''; selectedSub='';
  document.querySelectorAll('.category-btn,.subcat-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('[id^="subtags"]').forEach(d=>d.classList.add('hidden'));
  alert('记录成功');
}

document.getElementById('submitIncome').addEventListener('click',()=>{currentType='income'; addRecord('income');});
document.getElementById('submitExpense').addEventListener('click',()=>{currentType='expense'; addRecord('expense');});

function refreshTable(filter='all', typeFilter='income'){
  const body=document.getElementById('tableBody'); body.innerHTML='';
  let filtered=records.filter(r=>(filter==='all'||r.category===filter));
  filtered.forEach((r,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td><input type='checkbox' class='delete-checkbox' data-id='${i}'></td><td>${r.date}</td><td>${r.amount}</td><td>${r.category}${r.sub?'-'+r.sub:''}</td><td>${r.note}</td>`;
    body.appendChild(tr);
  });
  updateSummary();
}

function showTable(filter='all', typeFilter='income'){
  currentType=typeFilter;
  document.getElementById('input-page').classList.add('hidden');
  document.getElementById('table-page').classList.remove('hidden');
  refreshTable(filter,typeFilter);
}

function backToInput(){
  document.getElementById('table-page').classList.add('hidden');
  document.getElementById('input-page').classList.remove('hidden');
}

function deleteSelected(){
  const boxes=document.querySelectorAll('.delete-checkbox');
  let toDelete=[];
  boxes.forEach(b=>{if(b.checked)toDelete.push(parseInt(b.dataset.id));});
  records=records.filter((_,i)=>!toDelete.includes(i));
  localStorage.setItem('records',JSON.stringify(records));
  refreshTable('all',currentType);
}

function updateSummary(){
  const totalIncome=records.filter(r=>r.type==='income').reduce((a,b)=>a+b.amount,0);
  const totalExpense=records.filter(r=>r.type==='expense').reduce((a,b)=>a+b.amount,0);
  const now=new Date();
  const monthIncome=records.filter(r=>new Date(r.date).getMonth()===now.getMonth() && r.type==='income').reduce((a,b)=>a+b.amount,0);
  const monthExpense=records.filter(r=>new Date(r.date).getMonth()===now.getMonth() && r.type==='expense').reduce((a,b)=>a+b.amount,0);
  const summary=document.getElementById('summary');
  summary.innerHTML=`总资产: ${totalIncome-totalExpense}  总收入: ${totalIncome}  总支出: ${totalExpense}  本月收入: ${monthIncome}  本月支出: ${monthExpense}`;
}

// 复制导出功能
document.getElementById('copyBtn').addEventListener('click',()=>{
  const text=records.map(r=>`${r.date}｜${r.amount}｜${r.category}${r.sub?'-'+r.sub:''}｜${r.note}`).join('\n');
  navigator.clipboard.writeText(text).then(()=>{alert('已复制，可直接粘贴');});
});

function showWeekly(){
  let now=new Date();
  let monday=new Date(now.setDate(now.getDate()-now.getDay()+1));
  let weekRecords=records.filter(r=>new Date(r.date)>=monday);
  let recordsBackup=records; records=weekRecords; showTable('all',currentType); records=recordsBackup;
}

function showMonthly(){
  let now=new Date();
  let monthAgo=new Date(now.setDate(now.getDate()-30));
  let monthRecords=records.filter(r=>new Date(r.date)>=monthAgo);
  let recordsBackup=records; records=monthRecords; showTable('all',currentType); records=recordsBackup;
}
</script>
</body>
</html>
